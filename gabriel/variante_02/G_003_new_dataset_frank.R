require("data.table")
require("Rcpp")
require("rlist")
require("yaml")

directory.root  <- "~/buckets/b1/"  #Google Cloud
#directory.root  <- "E:/Archivo/EconFin"  #Local
setwd( directory.root )

dataset <- fread("./datasetsOri/paquete_premium.csv.gz")
#dataset <- fread("./datasetsOri/paquete_premium_202009.csv")

names(dataset)

dim(dataset)

columnas_rankeables <- c(
    "cliente_edad",
    "cliente_antiguedad",
    "mrentabilidad",
    "mrentabilidad_annual",
    "mcomisiones",
    "mactivos_margen",
    "mpasivos_margen",
    "cproductos",
    "tpaquete2", #
    "tpaquete3",
    "tpaquete4",
    "tcuentas",
    "ccuenta_corriente",
    "mcuenta_corriente_adicional",
    "mcuenta_corriente",
    "ccaja_ahorro",
    "mcaja_ahorro",
    "mcaja_ahorro_adicional",
    "mcaja_ahorro_dolares",
    "mdescubierto_preacordado",
    "mcuentas_saldo",
    "ctarjeta_debito",
    "ctarjeta_debito_transacciones",
    "mautoservicio",
    "ctarjeta_visa",
    "ctarjeta_visa_transacciones",
    "mtarjeta_visa_consumo",
    "ctarjeta_master",
    "ctarjeta_master_transacciones",
    "mtarjeta_master_consumo",
    "cprestamos_personales",
    "mprestamos_personales",
    "cprestamos_prendarios",
    "mprestamos_prendarios",
    "cprestamos_hipotecarios",
    "mprestamos_hipotecarios",
    "cplazo_fijo",
    "mplazo_fijo_dolares",
    "mplazo_fijo_pesos",
    "cinversion1",
    "minversion1_pesos",
    "minversion1_dolares",
    "cinversion2",
    "minversion2",
    "cseguro_vida",
    "cseguro_auto",
    "cseguro_vivienda",
    "cseguro_accidentes_personales",
    "ccaja_seguridad",
    "cpayroll_trx",
    "mpayroll",
    "mpayroll2",
    "cpayroll2_trx",
    "ccuenta_debitos_automaticos",
    "mcuenta_debitos_automaticos",
    "ctarjeta_visa_debitos_automaticos",
    #"mtarjeta_visa_debitos_automaticos", #
    "ctarjeta_master_debitos_automaticos",
    "mttarjeta_master_debitos_automaticos",
    "cpagodeservicios",
    "mpagodeservicios",
    "cpagomiscuentas",
    "mpagomiscuentas",
    "ccajeros_propios_descuentos",
    "mcajeros_propios_descuentos",
    "ctarjeta_visa_descuentos",
    "mtarjeta_visa_descuentos",
    "ctarjeta_master_descuentos",
    "mtarjeta_master_descuentos",
    "ccomisiones_mantenimiento",
    "mcomisiones_mantenimiento",
    "ccomisiones_otras",
    "mcomisiones_otras",
    "cforex",
    "cforex_buy",
    "mforex_buy",
    "cforex_sell",
    "mforex_sell",
    "ctransferencias_recibidas",
    "mtransferencias_recibidas",
    "ctransferencias_emitidas",
    "mtransferencias_emitidas",
    "cextraccion_autoservicio",
    "mextraccion_autoservicio",
    "ccheques_depositados",
    "mcheques_depositados",
    "ccheques_emitidos",
    "mcheques_emitidos",
    "ccheques_depositados_rechazados",
    "mcheques_depositados_rechazados",
    "ccheques_emitidos_rechazados",
    "mcheques_emitidos_rechazados",
    "ccallcenter_transacciones",
    "chomebanking_transacciones",
    "ccajas_transacciones",
    "ccajas_consultas",
    "ccajas_depositos",
    "ccajas_extracciones",
    "ccajas_otras",
    "catm_trx",
    "matm",
    "catm_trx_other",
    "matm_other",
    "ctrx_quarter",
    "cmobile_app_trx",
    "Master_mfinanciacion_limite",
    "Master_Fvencimiento",
    "Master_Finiciomora",
    "Master_msaldototal",
    "Master_msaldopesos",
    "Master_msaldodolares",
    "Master_mconsumospesos",
    "Master_mconsumosdolares",
    "Master_mlimitecompra",
    "Master_madelantopesos",
    "Master_madelantodolares",
    "Master_fultimo_cierre",
    "Master_mpagado",
    "Master_mpagospesos",
    "Master_mpagosdolares",
    "Master_fechaalta",
    "Master_mconsumototal",
    "Master_cconsumos",
    "Master_cadelantosefectivo",
    "Master_mpagominimo",
    "Visa_mfinanciacion_limite",
    "Visa_Fvencimiento",
    "Visa_Finiciomora",
    "Visa_msaldototal",
    "Visa_msaldopesos",
    "Visa_msaldodolares",
    "Visa_mconsumospesos",
    "Visa_mconsumosdolares",
    "Visa_mlimitecompra",
    "Visa_madelantopesos",
    "Visa_madelantodolares",
    "Visa_fultimo_cierre",
    "Visa_mpagado",
    "Visa_mpagospesos",
    "Visa_mpagosdolares",
    "Visa_fechaalta",
    "Visa_mconsumototal",
    "Visa_cconsumos",
    "Visa_cadelantosefectivo",
    "Visa_mpagominimo")


for (columna in columnas_rankeables)
{
  dataset[, paste0(columna,"_rank") := frankv(dataset, cols=c(columna))]
}


fwrite( dataset,
        "./datasetsOri/paquete_premium_rank.csv.gz",
        logical01 = TRUE,
        sep= "," )


dim(dataset)